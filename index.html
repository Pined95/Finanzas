<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Entidad Financiera Inteligente</title>
    <style>
        :root {
            --primary: #2563eb; --bg: #f1f5f9; --card: #ffffff;
            --text: #1e293b; --muted: #64748b; --success: #10b981; --danger: #ef4444;
        }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        
        /* Header & Toggle */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .toggle-container { background: #e2e8f0; border-radius: 20px; padding: 3px; display: flex; }
        .toggle-btn { border: none; background: none; padding: 8px 16px; border-radius: 17px; cursor: pointer; color: var(--muted); font-weight: 600; font-size: 0.9rem; transition: 0.3s; }
        .toggle-btn.active { background: var(--card); color: var(--primary); shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* Cards */
        .card { background: var(--card); padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .balance-title { font-size: 0.9rem; color: var(--muted); }
        .balance-val { font-size: 2.5rem; font-weight: 800; margin: 5px 0; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .stat-item { padding: 10px; border-radius: 8px; font-size: 0.9rem; }
        .stat-inc { background: #dcfce7; color: #166534; }
        .stat-exp { background: #fee2e2; color: #991b1b; }

        /* AI Insights */
        .ai-box { border-left: 4px solid var(--primary); background: #eff6ff; padding: 15px; border-radius: 0 12px 12px 0; margin-bottom: 20px; }
        .ai-title { font-weight: 700; color: var(--primary); display: block; margin-bottom: 5px; font-size: 0.9rem; }
        .ai-text { margin: 0; font-size: 0.9rem; line-height: 1.4; }

        /* List */
        .tx-list { list-style: none; padding: 0; margin: 0; }
        .tx-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #f1f5f9; }
        .tx-desc { font-weight: 600; display: block; }
        .tx-meta { font-size: 0.8rem; color: var(--muted); }
        .amount { font-weight: 700; }
        .amount.inc { color: var(--success); }
        .amount.exp { color: var(--danger); }

        /* FAB & Modal */
        .fab { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; width: 56px; height: 56px; border-radius: 50%; border: none; font-size: 24px; box-shadow: 0 10px 15px -3px rgba(37,99,235,0.4); cursor: pointer; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: flex-end; z-index: 100; }
        .modal.open { display: flex; }
        .modal-content { background: var(--card); width: 100%; border-radius: 20px 20px 0 0; padding: 25px; animation: slideUp 0.3s; box-sizing: border-box; }
        @keyframes slideUp { from {transform: translateY(100%);} to {transform: translateY(0);} }
        
        input, select, button.btn-save { width: 100%; padding: 14px; margin-bottom: 12px; border: 1px solid #cbd5e1; border-radius: 10px; font-size: 1rem; box-sizing: border-box; }
        button.btn-save { background: var(--primary); color: white; border: none; font-weight: 700; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <span style="font-size:0.8rem; font-weight:700; color:var(--muted); letter-spacing:1px;">FINANCE OS</span>
            <div style="font-weight:700; font-size:1.2rem;">Hola, Alex</div>
        </div>
        <div class="toggle-container">
            <button class="toggle-btn active" id="btnPersonal" onclick="app.setMode('personal')">Mío</button>
            <button class="toggle-btn" id="btnJoint" onclick="app.setMode('joint')">Nosotros</button>
        </div>
    </header>

    <div class="card">
        <div class="balance-title">Patrimonio Disponible</div>
        <div class="balance-val" id="displayBalance">$0.00</div>
        <div class="stats-grid">
            <div class="stat-item stat-inc">⬇ Ingresos: <span id="displayInc">$0</span></div>
            <div class="stat-item stat-exp">⬆ Gastos: <span id="displayExp">$0</span></div>
        </div>
    </div>

    <div id="aiSection" class="ai-box" style="display:none;">
        <span class="ai-title">✨ Análisis Inteligente</span>
        <p class="ai-text" id="aiMessage">Todo parece en orden.</p>
    </div>

    <div class="card">
        <h3 style="margin-top:0; font-size:1rem;">Movimientos Recientes</h3>
        <ul class="tx-list" id="txList"></ul>
        <div id="emptyState" style="text-align:center; color:var(--muted); padding:20px; font-size:0.9rem;">
            No hay registros en esta cuenta.
        </div>
    </div>
</div>

<button class="fab" onclick="ui.toggleModal(true)">+</button>

<div class="modal" id="txModal" onclick="if(event.target === this) ui.toggleModal(false)">
    <div class="modal-content">
        <h2 style="margin:0 0 20px 0;">Nuevo Movimiento</h2>
        <input type="number" id="inpAmount" placeholder="Monto (ej: 150)">
        <input type="text" id="inpDesc" placeholder="Concepto (ej: Cena)">
        <select id="inpType">
            <option value="expense">Gasto (-)</option>
            <option value="income">Ingreso (+)</option>
        </select>
        <button class="btn-save" onclick="app.addTransaction()">Guardar</button>
    </div>
</div>

<script>
/** * ARQUITECTURA DEL SISTEMA 
 * Separación de responsabilidades: Storage (Datos), Logic (Cálculos), UI (Vista)
 */

// --- 1. CAPA DE DATOS (Storage Layer) ---
const DataStore = {
    // Keys para LocalStorage simulando dos bases de datos distintas
    KEYS: {
        personal: 'fin_db_personal_v1',
        joint: 'fin_db_joint_v1'
    },

    get: (mode) => {
        const data = localStorage.getItem(DataStore.KEYS[mode]);
        return data ? JSON.parse(data) : [];
    },

    add: (mode, transaction) => {
        const currentData = DataStore.get(mode);
        currentData.unshift(transaction); // Agrega al inicio
        localStorage.setItem(DataStore.KEYS[mode], JSON.stringify(currentData));
        return currentData;
    }
};

// --- 2. CAPA LÓGICA (Business Logic & Intelligence) ---
const FinanceBrain = {
    calculateTotals: (transactions) => {
        let balance = 0, income = 0, expense = 0;
        transactions.forEach(tx => {
            const amount = parseFloat(tx.amount);
            if(tx.type === 'income') {
                income += amount;
                balance += amount;
            } else {
                expense += amount;
                balance -= amount;
            }
        });
        return { balance, income, expense };
    },

    // El "Cerebro": Genera recomendaciones basadas en reglas
    analyzeHealth: (totals, mode) => {
        if (totals.balance < 0) {
            return { type: 'alert', msg: `¡Cuidado! Estás en números rojos en tu cuenta ${mode === 'joint' ? 'compartida' : 'personal'}. Reduce gastos inmediatos.` };
        }
        if (totals.income > 0 && (totals.expense / totals.income) > 0.9) {
            return { type: 'warning', msg: 'Alerta de liquidez: Estás gastando el 90% de lo que ganas. Intenta ahorrar al menos el 20%.' };
        }
        if (mode === 'joint' && totals.balance > 2000) {
            return { type: 'success', msg: 'Excelente salud financiera en pareja. Tienen superávit para invertir o planear un viaje.' };
        }
        return null; // Sin alertas relevantes
    }
};

// --- 3. CAPA DE INTERFAZ (UI Controller) ---
const ui = {
    formatMoney: (n) => new Intl.NumberFormat('es-MX', {style:'currency', currency:'MXN'}).format(n),
    
    toggleModal: (show) => {
        document.getElementById('txModal').classList.toggle('open', show);
        if(!show) ui.clearForm();
    },

    clearForm: () => {
        document.getElementById('inpAmount').value = '';
        document.getElementById('inpDesc').value = '';
    },

    render: (transactions, totals, insight, mode) => {
        // Render Totals
        document.getElementById('displayBalance').innerText = ui.formatMoney(totals.balance);
        document.getElementById('displayBalance').style.color = totals.balance < 0 ? 'var(--danger)' : 'var(--text)';
        document.getElementById('displayInc').innerText = ui.formatMoney(totals.income);
        document.getElementById('displayExp').innerText = ui.formatMoney(totals.expense);

        // Render Insight
        const aiBox = document.getElementById('aiSection');
        const aiMsg = document.getElementById('aiMessage');
        if(insight) {
            aiBox.style.display = 'block';
            aiMsg.innerText = insight.msg;
            aiBox.style.borderLeftColor = insight.type === 'alert' ? 'var(--danger)' : (insight.type === 'warning' ? '#f59e0b' : 'var(--success)');
        } else {
            aiBox.style.display = 'none';
        }

        // Render List
        const list = document.getElementById('txList');
        const empty = document.getElementById('emptyState');
        list.innerHTML = '';
        
        if(transactions.length === 0) {
            empty.style.display = 'block';
        } else {
            empty.style.display = 'none';
            transactions.forEach(tx => {
                const li = document.createElement('li');
                li.className = 'tx-item';
                li.innerHTML = `
                    <div>
                        <span class="tx-desc">${tx.desc}</span>
                        <span class="tx-meta">${new Date(tx.date).toLocaleDateString()}</span>
                    </div>
                    <div class="amount ${tx.type === 'income' ? 'inc' : 'exp'}">
                        ${tx.type === 'income' ? '+' : '-'}${ui.formatMoney(tx.amount)}
                    </div>
                `;
                list.appendChild(li);
            });
        }

        // Toggle Buttons
        document.getElementById('btnPersonal').className = `toggle-btn ${mode === 'personal' ? 'active' : ''}`;
        document.getElementById('btnJoint').className = `toggle-btn ${mode === 'joint' ? 'active' : ''}`;
    }
};

// --- 4. CONTROLADOR PRINCIPAL (App Core) ---
const app = {
    mode: 'personal', // Estado inicial

    init: () => {
        app.refresh();
    },

    setMode: (newMode) => {
        app.mode = newMode;
        app.refresh();
    },

    addTransaction: () => {
        const amt = document.getElementById('inpAmount').value;
        const desc = document.getElementById('inpDesc').value;
        const type = document.getElementById('inpType').value;

        if(!amt || !desc) return alert("Completa todos los datos");

        const tx = {
            id: Date.now(),
            date: new Date().toISOString(),
            amount: parseFloat(amt),
            desc: desc,
            type: type
        };

        DataStore.add(app.mode, tx);
        ui.toggleModal(false);
        app.refresh();
    },

    refresh: () => {
        const txs = DataStore.get(app.mode);
        const totals = FinanceBrain.calculateTotals(txs);
        const insight = FinanceBrain.analyzeHealth(totals, app.mode);
        ui.render(txs, totals, insight, app.mode);
    }
};

// Iniciar aplicación
app.init();
</script>
</body>
</html>